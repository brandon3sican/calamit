{% extends 'dashboard-layout/base.html' %}
{% load static %}

{% block content %}
<main id="main" class="main">
    <div class="pagetitle">
        <h1>Factor Rating</h1>
        <nav>
            <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard-home'%}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'risk-assessment-list'%}">Risk Assessment</a></li>
            <li class="breadcrumb-item active">{{ risk_assessment.landmark }}, {{ risk_assessment.barangay.barangay_name }}</li>
            </ol>
        </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                <h5 class="card-title">{{ risk_assessment.landmark }}, {{ risk_assessment.barangay.barangay_name }}
                
                <form method="POST" action="{% url 'risk-assessment-delete' risk_assessment.id %}" class="float-end">
                    <a href="{% url 'risk-assessment-update' risk_assessment.id %}"><i class="bi bi-pencil-fill text-primary" type="button"></i></a> &nbsp

                    {% csrf_token %}
                    <i class="bi bi-trash-fill text-warning show_confirm" type="button"></i>
                </form>
                </h5>
                <div class="table-responsive col-lg-8">
                    <table class="table" id="det">
                        <tbody>
                            <tr>
                              <th scope="row" width="30%">Latitude</th>
                              <td id="latitude" width="70%">{{ risk_assessment.latitude }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Longitude</th>
                                <td id="longitude">{{ risk_assessment.longitude }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Elevation</th>
                                <td>{{ risk_assessment.elevation }}</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.vFactor.factor.factor_name }}</th>
                                <td>{{ risk_assessment.vFactor.factor_rating_name }} ( {{ risk_assessment.vFactor.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.fFactor.factor.factor_name }}</th>
                                <td>{{ risk_assessment.fFactor.factor_rating_name }} ( {{ risk_assessment.fFactor.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.sRed.factor.factor_name }}</th>
                                <td>{{ risk_assessment.sRed.factor_rating_name }} ( {{ risk_assessment.sRed.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.dRed.factor.factor_name }}</th>
                                <td>{{ risk_assessment.dRed.factor_rating_name }} ( {{ risk_assessment.dRed.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.lFactor.factor.factor_name }}</th>
                                <td>{{ risk_assessment.lFactor.factor_rating_name }} ( {{ risk_assessment.lFactor.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.sRating.factor.factor_name }}</th>
                                <td>{{ risk_assessment.sRating.factor_rating_name }} ( {{ risk_assessment.sRating.factor_rating_value }} )</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ risk_assessment.aRating.factor.factor_name }}</th>
                                <td>{{ risk_assessment.aRating.factor_rating_name }} ( {{ risk_assessment.aRating.factor_rating_value }} )</td>
                            </tr>
                            <tr class="table-info">
                                <th scope="row">Factor of Safety</th>
                                <td class = "fw-bold">{{ fs_result }} ( {{ factor_of_safety }} )</td>
                            </tr>
                          </tbody>
                    </table>
                  </div>
                </div>

                <!-- Display Map Here -->
                <div class="table-responsive col-lg-4" id="map" style="height: 400px; width: 800px">
                </div>
            </div>
        </div>
      </div>
    </section>
</main>
{% endblock content %}

{% block javascript %}
  <script>
    {% if messages %}
        {% for message in messages %}
        swal({
            title: "Success!",
            text: "{{ message }}",
            icon: "success",
            button: "OK",
        });
        {% endfor %}
    {% endif %}

  $('.show_confirm').click(function(event) {
    var form =  $(this).closest("form");
    event.preventDefault();
    swal({
        text: "Are you sure you want to permanently delete this record?",
        icon: "warning",
        buttons: {
          cancel: "No, Cancel",
          confirm: {
            text: "Yes, Delete",
            value: "confirm"
          }  
        }
    })
    .then((willDelete) => {
        if (willDelete) {
            form.submit();
        }
    });
  });

  $(window).on('load', function() {
        var latitude = $(".table #latitude").text();
        var longitude = $(".table #longitude").text();
        console.log (latitude + " " + longitude)
        var map = L.map('map').setView([latitude, longitude], 18);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        L.marker([latitude, longitude]).addTo(map)

    });
    
  </script>
{% endblock javascript%}